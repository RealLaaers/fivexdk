import{u as f,r as C,E as x,p as v,q as g,a as t,F as T,j as i,L as n,m as O,c3 as oe,k as Y,bA as ce,C as b,c4 as re,aw as le,bZ as de,b as F,_ as q,I as me,f as D,a0 as Se,d as Pe,bR as B,a4 as Ee,t as z,K as ue,a7 as J,a8 as pe,A as G,ab as $,P as V,w as he,e as K,g as Ce,h as te,D as Q,H as X,bz as ae,c5 as ve,c6 as Z,N as ne,az as Ie,i as Ne,S as ie,$ as ge,x as fe,c7 as be}from"./index-ab956fb7.js";import{S as ee}from"./Switch-f4764cb6.js";const w={companies:[{job:"police",name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png",canCall:!0,canMessage:!0,bossRanks:["boss","lieutenant"],open:!0,location:{name:"Mission Row",coords:{x:428.9,y:-984.5}}},{job:"ambulance",name:"Ambulance",icon:"https://cdn-icons-png.flaticon.com/128/1032/1032989.png",canCall:!0,canMessage:!0,bossRanks:["boss","doctor"],open:!0,location:{name:"Pillbox",coords:{x:304.2,y:-587}}},{job:"mechanic",name:"Mechanic",icon:"https://cdn-icons-png.flaticon.com/128/10281/10281554.png",canCall:!0,canMessage:!0,bossRanks:["boss","worker"],open:!1,location:{name:"LS Customs",coords:{x:-336.6,y:-134.3}}},{job:"taxi",name:"Taxi",icon:"https://cdn-icons-png.flaticon.com/128/433/433449.png",canCall:!0,canMessage:!0,bossRanks:["boss","driver"],open:!1,location:{name:"Taxi HQ",coords:{x:984.2,y:-219}}}],company:{job:"police",duty:!0,receiveCalls:!0,isBoss:!0,balance:1e6,employees:[{id:1,name:"Breze",grade:1,gradeLabel:"Officer",canInteract:!0,online:!0},{id:2,name:"Loaf Scripts",grade:2,gradeLabel:"Sergeant",canInteract:!0,online:!0},{id:3,name:"Kash",grade:3,gradeLabel:"Lieutenant",canInteract:!0,online:!1}],grades:[{label:"Officer",grade:1},{label:"Sergeant",grade:2},{label:"Lieutenant",grade:3},{label:"Captain",grade:4}]},messageList:[{id:"1",lastMessage:"Is anyone available to help me?",sender:"Breze",number:"1234567890",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*2},{id:"2",lastMessage:"Hello, how can i help you?",sender:"Loaf Scripts",number:"4802940940",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*4},{id:"3",lastMessage:"Hey, i need backup at the bank",sender:"Sally",number:"2051440412",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*24*2}],messages:{1:[{id:"1",sender:"1234567890",content:"Is anyone available to help me?",timestamp:Date.now()-1e3*60*60*2},{id:"2",sender:"1234567323",content:"Hey, a unit is on its way to your location",timestamp:Date.now()-1e3*60*60*24*2},{id:"3",sender:"1234567890",content:"i'd like to report a crime, i'm at the pier",timestamp:Date.now()-1e3*60*60*24*2}],2:[{id:"1",sender:"4802940940",content:"Hey, can you help me?",timestamp:Date.now()-1e3*60*60*4},{id:"2",sender:"4802940940",content:"I need a unit to my location",timestamp:Date.now()-1e3*60*60*24*5},{id:"3",sender:"4802940940",content:"I need backup at the bank",timestamp:Date.now()-1e3*60*60*24*9}],3:[{id:"1",sender:"2051440412",content:"is there any way you have any job positions available?",timestamp:Date.now()-1e3*60*60*24*2},{id:"2",sender:"2051440412",content:"hello?",timestamp:Date.now()-1e3*60*60*24*4},{id:"3",sender:"2051440412",content:"hey, i have a question",timestamp:Date.now()-1e3*60*60*24*5}]},employees:[{firstname:"John",lastname:"Doe",grade:1,gradeLabel:"Officer",number:"1234567890",online:!0},{firstname:"Loaf",lastname:"Scripts",grade:2,gradeLabel:"Sergeant",number:"4802940940",online:!0},{firstname:"Kash",grade:3,gradeLabel:"Lieutenant",number:"2051440412",online:!1},{firstname:"Sally",grade:4,gradeLabel:"Captain",number:"1234567323",online:!0}]};function Ae(){var P,s,E,p,A,r,I,y,_,U,k,m,h;const e=f(F),[a,o]=C.useState(null),[u,l]=C.useState(null);C.useEffect(()=>{x("Services")&&v("Services",{action:"getCompany"},w.company).then(c=>{if(!c)return g("warning","Failed to fetch company data");o(c)})},[]);const d=()=>{b.PopUp.set({title:n("APPS.SERVICES.DEPOSIT_POPUP.TITLE"),description:n("APPS.SERVICES.DEPOSIT_POPUP.DESCRIPTION"),input:{placeholder:n("APPS.SERVICES.DEPOSIT_POPUP.AMOUNT"),onChange:c=>{l(c)},type:"number"},buttons:[{title:n("APPS.SERVICES.DEPOSIT_POPUP.CANCEL")},{title:n("APPS.SERVICES.DEPOSIT_POPUP.PROCEED"),cb:()=>{l(c=>{/^\d+$/.test(c)&&v("Services",{action:"depositMoney",amount:parseInt(c)},parseInt(c)+a.balance).then(N=>{if(typeof N!="number")return g("warning","Balance is not a number, not updating");o({...a,balance:N})})})}}]})},S=()=>{b.PopUp.set({title:n("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:n("APPS.SERVICES.WITHDRAW_POPUP.DESCRIPTION"),input:{placeholder:n("APPS.SERVICES.WITHDRAW_POPUP.AMOUNT"),onChange:c=>{l(c)},type:"number"},buttons:[{title:n("APPS.SERVICES.WITHDRAW_POPUP.CANCEL")},{title:n("APPS.SERVICES.WITHDRAW_POPUP.PROCEED"),cb:()=>{l(c=>{if(/^\d+$/.test(c)){if(a.balance-parseInt(c)<0){b.PopUp.set({title:n("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:n("APPS.SERVICES.WITHDRAW_POPUP.NOT_ENOUGH_MONEY").format({amount:c}),buttons:[{title:n("APPS.SERVICES.WITHDRAW_POPUP.PROCEED")}]});return}v("Services",{action:"withdrawMoney",amount:parseInt(c)},a.balance-parseInt(c)).then(N=>{if(typeof N!="number")return g("warning","Balance is not a number, not updating");o({...a,balance:N})})}})}}]})};return t(T,{children:a!=null&&a.job?i("div",{className:"actions-container",children:[t("div",{className:"category-title",children:n("APPS.SERVICES.SETTINGS")}),t("section",{children:i(T,{children:[a.duty!==void 0&&((s=(P=e==null?void 0:e.Companies)==null?void 0:P.Management)==null?void 0:s.Duty)!==!1&&i(O.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[t(oe,{className:"orange"}),i("div",{className:"item-info",children:[t("div",{className:"title",children:n("APPS.SERVICES.DUTY")}),t("div",{className:"description",children:n("APPS.SERVICES.DUTY_DESCRIPTION")})]})]}),t("div",{className:"item-value",children:t(ee,{checked:a.duty,onChange:()=>{v("Services",{action:"toggleDuty",duty:!a.duty},!0).then(()=>o({...a,duty:!a.duty}))}})})]}),(a.duty===void 0||a.duty===!0)&&i(O.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[t(Y,{className:"green"}),i("div",{className:"item-info",children:[t("div",{className:"title",children:n("APPS.SERVICES.JOB_CALLS")}),i("div",{className:"description",children:[" ",n("APPS.SERVICES.JOB_CALLS_DESCRIPTION").format({toggle:a.receiveCalls?n("APPS.SERVICES.DISABLE"):n("APPS.SERVICES.ENABLE")})]})]})]}),t("div",{className:"item-value",children:t(ee,{checked:a.receiveCalls,onChange:()=>{v("Services",{action:"toggleCalls"},!a.receiveCalls).then(c=>{o({...a,receiveCalls:c})})}})})]})]})}),a.isBoss&&i(T,{children:[t("div",{className:"category-title",children:n("APPS.SERVICES.ACTIONS")}),i("section",{children:[i(O.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[t(ce,{className:"green"}),i("div",{className:"item-info",children:[t("div",{className:"title",children:n("APPS.SERVICES.BALANCE")}),t("div",{className:"description",children:"Current balance of the company"})]})]}),t("div",{className:"item-value",children:e.CurrencyFormat.replace("%s",(E=a.balance)==null?void 0:E.toLocaleString())})]}),(((A=(p=e==null?void 0:e.Companies)==null?void 0:p.Management)==null?void 0:A.Deposit)!==!1||((I=(r=e==null?void 0:e.Companies)==null?void 0:r.Management)==null?void 0:I.Withdraw)!==!1)&&i("div",{className:"item",children:[((_=(y=e==null?void 0:e.Companies)==null?void 0:y.Management)==null?void 0:_.Deposit)!==!1&&t("div",{className:"button",onClick:d,children:n("APPS.SERVICES.DEPOSIT_POPUP.TITLE")}),((k=(U=e==null?void 0:e.Companies)==null?void 0:U.Management)==null?void 0:k.Withdraw)!==!1&&t("div",{className:"button",onClick:S,children:n("APPS.SERVICES.WITHDRAW_POPUP.TITLE")})]})]}),t("div",{className:"category-title",children:n("APPS.SERVICES.MANAGE_EMPLOYEES")}),i("section",{children:[((h=(m=e==null?void 0:e.Companies)==null?void 0:m.Management)==null?void 0:h.Hire)!==!1&&i(O.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",onClick:()=>{b.PopUp.set({title:n("APPS.SERVICES.HIRE_POPUP.TITLE"),description:n("APPS.SERVICES.HIRE_POPUP.DESCRIPTION"),input:{type:"number",placeholder:n("APPS.SERVICES.HIRE_POPUP.PLACEHOLDER"),onChange:c=>{l(c)}},buttons:[{title:n("APPS.SERVICES.HIRE_POPUP.CANCEL")},{title:n("APPS.SERVICES.HIRE_POPUP.PROCEED"),cb:()=>{l(c=>{if(/^\d+$/.test(c))return v("Services",{action:"hireEmployee",source:parseInt(c)},{id:c,name:"Joe Doe"}).then(N=>{N&&o({...a,employees:[...a.employees,{id:N.id,name:N.name,grade:0,gradeLabel:a.grades[0].label,canInteract:!0}]})}),""})}}]})},children:[i("div",{className:"item-data",children:[t(re,{className:"blue"}),i("div",{className:"item-info",children:[t("div",{className:"title",children:n("APPS.SERVICES.HIRE")}),t("div",{className:"description",children:n("APPS.SERVICES.HIRE_POPUP.DESCRIPTION")})]})]}),t("div",{className:"item-value",children:t(le,{})})]}),a.employees.map((c,N)=>i(O.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",onClick:()=>{if(!c.canInteract||e.Companies.Management.Fire===!1&&e.Companies.Management.Promote===!1)return;const se=[e.Companies.Management.Promote!==!1&&{title:n("APPS.SERVICES.SET_GRADE"),cb:()=>{setTimeout(()=>{b.ContextMenu.set({buttons:[...a.grades.map(R=>({title:R.label,cb:()=>{v("Services",{action:"setGrade",employee:c.id,grade:R.grade},!0).then(W=>{if(!W)return g("warning","Failed to set grade");o({...a,employees:a.employees.map(H=>(H.id===c.id&&(H.grade=R.grade,H.gradeLabel=R.label),H))})})}}))]})},300)}},e.Companies.Management.Fire!==!1&&{title:n("APPS.SERVICES.FIRE_POPUP.TITLE"),color:"red",cb:()=>{b.PopUp.set({title:n("APPS.SERVICES.FIRE_POPUP.TITLE"),description:n("APPS.SERVICES.FIRE_POPUP.DESCRIPTION").format({name:c.name}),buttons:[{title:n("APPS.SERVICES.FIRE_POPUP.CANCEL")},{title:n("APPS.SERVICES.FIRE_POPUP.PROCEED"),color:"red",cb:()=>{v("Services",{action:"fireEmployee",employee:c.id},!0).then(R=>{if(!R)return g("warning","Failed to fire employee");o({...a,employees:a.employees.filter(W=>W.id!==c.id)})})}}]})}}];b.ContextMenu.set({buttons:se.filter(R=>R)})},children:[i("div",{className:"item-data",children:[t(de,{}),i("div",{className:"item-info",children:[t("div",{className:"title",children:c.name}),i("div",{className:"description",children:[" ",c.gradeLabel]})]})]}),t("div",{className:"item-value",children:t("div",{className:"status","data-online":c.online})})]},N))]})]})]}):t("div",{className:"no-job",children:n("APPS.SERVICES.UNEMPLOYED")})})}function Oe(){const e=f(V.Settings),a=f(V.PhoneNumber),o=f(L),[u,l]=C.useState(0),[d,S]=C.useState(!1),[P,s]=C.useState(!1),[E,p]=C.useState([]),A=C.useRef(null),[r,I]=C.useState({content:"",attachments:[]});C.useEffect(()=>{x("Services")&&v("Services",{action:"getMessages",page:0,id:o.id,company:o.job},w.messages[o.id]).then(m=>{if(m&&m.length>0){p([...m.reverse()]);let h=document.querySelector(".chat-container");h.scrollTop=h.scrollHeight}else S(!0)})},[]);const y=()=>{if(r.content.length>0){let m={sender:a,id:o.id,company:o.job,content:r.content,timestamp:new Date};if(e.airplaneMode)return p(h=>[...h,{...m,delivered:!1}]);v("Services",{action:"sendMessage",...m},!0).then(h=>{h||g("error","Failed to send message"),p(c=>[...c,{...m,delivered:h}]),I({content:"",attachments:[]}),A.current.value=""})}},_=()=>{b.PopUp.set({title:n("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:n("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:n("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:n("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{v("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(m=>{if(!m)return g("error","Failed to get location");let h={sender:a,content:`<!SENT-LOCATION-X=${z(m.x,2)}Y=${z(m.y,2)}!>`,attachments:[],id:o.id,company:o.job,timestamp:new Date};v("Services",{action:"sendMessage",...h},!0).then(c=>{p(c?N=>[...N,h]:N=>[...N,{...h,delivered:!1}])})})}}]})},U=()=>{if(d||P)return;let m=document.querySelector("#last");if(!m)return;!ue(m)&&(s(!0),v("Services",{action:"getMessages",page:u+1,id:o.id,company:o.job},null).then(c=>{c&&c.length>0?(p([...c.reverse(),...E]),s(!1),c.length<25&&S(!0)):S(!0)}),l(c=>c+1))};q("services:newMessage",m=>{if(o.id!==m.channelId||m.sender===a||e.airplaneMode)return;p([...E,{...m,timestamp:new Date}]);let h=document.querySelector(".chat-container");h.scrollTop=h.scrollHeight});const k=m=>{if(m)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(m)};return i(T,{children:[i("div",{className:"chat-header",children:[t("div",{className:"back",onClick:()=>{M.set("messages"),L.reset()},children:t(me,{})}),i("div",{className:"user",children:[t("img",{src:o.icon??`./assets/img/avatar-placeholder-${e.display.theme}.svg`,className:"avatar"}),t("div",{className:"name",children:o.company??D(o.number)})]}),t(Se,{className:"hidden"})]}),t("div",{className:"chat-container",onScroll:U,children:t("div",{className:"chat-body",children:E.map((m,h)=>t(Re,{index:h,messages:E,message:m,func:{isLocation:k}}))})}),t("div",{className:"chat-bottom",children:i("div",{className:"input",children:[t(Pe,{placeholder:n("APPS.MESSAGES.PLACEHOLDER"),ref:A,value:r.content,onChange:m=>{I({content:m.target.value,attachments:r.attachments})},onKeyDown:m=>{m.key=="Enter"&&y()}}),i("div",{className:"buttons",children:[t("div",{className:"location",children:t(B,{onClick:_})}),r.content.length>0&&t("div",{className:"send",onClick:y,children:t(Ee,{})})]})]})})]})}const Re=({messages:e,message:a,index:o,func:u})=>{var r;const l=f(V.PhoneNumber),d=f(L);let S,P,s,E=o===0?"last":"",p=a.sender===l?"self":"other",A=((r=e[o+1])==null?void 0:r.sender)===l?"self":"other";if(e[o+1]?P=Math.abs(a.timestamp-e[o+1].timestamp)/36e5:A=void 0,u.isLocation(a.content)){let I=a.content.match(/X=(-?\d*\.?\d*)Y/)[1],y=a.content.match(/Y=(-?\d*\.?\d*)!>/)[1];s={x:I,y}}return i("div",{className:`message ${p}`,id:E,"data-id":a.id,children:[S,a.delivered===!1?i("div",{className:"content-wrapper",children:[t("div",{className:"content",children:J(a.content)}),t(pe,{})]}):s?i("div",{className:"location",onClick:()=>{G.patch({active:{name:"Maps",data:{location:[s.y,s.x],name:`${D(a.sender)}'s location`,icon:d.icon}}})},children:[t("div",{className:"img",style:{backgroundImage:'url("https://img.gta5-mods.com/q95/images/mirror-park-garden/2b72f9-20160428154103_1.jpg")'}}),p==="other"&&i("div",{className:"sender",children:[D(a.sender)," ",n("APPS.MESSAGES.SENT_LOCATION")]})]}):a.content&&t("div",{className:"content",children:J(a.content)}),a.delivered===!1?t("div",{className:"status",children:n("APPS.MESSAGES.NOT_DELIVERED")}):e[o+1]&&P>6?t("div",{className:"date",children:$(a.timestamp)}):p!==A&&t("div",{className:"date",children:$(a.timestamp)})]},o)},j=X(null);function Le(){var S,P;const e=f(j),[a,o]=C.useState("all"),[u,l]=C.useState(""),d=s=>{if(!s)return g("error","No number provided");b.PopUp.set({title:n("APPS.SERVICES.CALL_POPUP.TITLE"),description:n("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:D(s)}),buttons:[{title:n("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:n("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{let E=Q(s);d({...E,number:s})}}]})};return i(O.div,{initial:{opacity:0,y:250},animate:{opacity:1,y:0},exit:{opacity:0,y:250},transition:{duration:.2,ease:"easeInOut"},className:"employee-list",children:[i("div",{className:"employee-list-header",children:[t("div",{className:"close",onClick:()=>j.set(null)}),t("div",{className:"selector",children:["all","available"].map((s,E)=>t("div",{className:"option","data-active":a===s,onClick:()=>o(s),children:n(`APPS.SERVICES.${s.toUpperCase()}`)},E))}),t(he,{placeholder:n("APPS.SERVICES.SEARCH_EMPLOYEES"),onChange:s=>l(s.target.value)})]}),t("div",{className:"employee-list-body",children:(P=(S=e==null?void 0:e.filter(s=>(a==="all"?!0:s.online)&&K(s.firstname,s.lastname).toLowerCase().includes(u.toLowerCase())))==null?void 0:S.sort((s,E)=>E.grade-s.grade))==null?void 0:P.map((s,E)=>i(O.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"employee-item",children:[i("div",{className:"user",children:[t("div",{className:"avatar",children:Ce(s.firstname,s.lastname)}),i("div",{className:"info",children:[K(s.firstname,s.lastname),t("span",{children:s.gradeLabel})]})]}),t("div",{className:"buttons",children:i(T,{children:[t(Y,{className:s.online&&s.number?"green":"red",onClick:()=>d(s.number)}),t(te,{className:s.online&&s.number?"green":"red",onClick:()=>{if(!s.number)return g("error","No number provided");let p=Q(s.number);G.patch({active:{name:"Messages",data:{number:s.number,name:p==null?void 0:p.name,avatar:p==null?void 0:p.avatar,view:"messages"}}})}})]})})]},E))})]})}function Te(){var u;const[e,a]=C.useState([]),o=(u=f(G))==null?void 0:u.active;return C.useEffect(()=>{x("Services")&&v("Services",{action:"getCompanies"},w.companies).then(l=>{if(!l)return g("warning","Failed to fetch companies");a(l)})},[o]),q("services:updateOpen",l=>{if(!l)return;const{job:d,open:S}=l;a(P=>{const s=P.findIndex(E=>E.job===d);return s===-1?P:(P[s].open=S,[...P])})}),t(T,{children:t("div",{className:"companies-list",children:e.sort((l,d)=>l.open&&!d.open?-1:!l.open&&d.open?1:0).map(l=>t(ye,{company:l},l.name))})})}const ye=({company:e})=>{var s,E,p,A;const a=f(F),o=()=>{v("Services",{action:"getEmployees",company:e.job},w.employees).then(r=>{if(!r)return g("warning","You do not have permission to view employees.");j.set(r)})},[u,l]=C.useState(!1),d=r=>{var I;!((I=r==null?void 0:r.location)!=null&&I.coords)||!r.name||G.patch({active:{name:"Maps",data:{location:[r.location.coords.y,r.location.coords.x],name:r.name,icon:r.icon}}})},S=(r,I)=>{a.Companies.Enabled&&b.PopUp.set({title:n("APPS.SERVICES.CALL_POPUP.TITLE"),description:n("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:Ie(r)}),buttons:[{title:n("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:n("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{Ne({company:r,companylabel:I})}}]})},P=r=>{v("Services",{action:"getChannelId",company:r.job},"1").then(I=>{if(!I)return g("error","Failed to get channel id");L.set({icon:r.icon,company:r.name,job:r.job,id:I}),M.set("chat")})};return i("div",{className:"item",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),"data-open":e.open,onClick:o,children:[i("div",{className:"info",children:[e.icon&&t("div",{className:"icon",children:t("img",{src:e.icon})}),i("div",{className:"company-details",children:[t("div",{className:"title",children:e.name}),i("div",{className:"location",children:[t(ae,{}),(s=e.location)==null?void 0:s.name]})]})]}),e.open?i("div",{className:"actions",children:[e.customIcon&&t("div",{className:"custom-icon",onClick:r=>{r.stopPropagation(),v("Services",{action:"customIconClick",company:e.job})},children:ve[e.customIcon]()}),((E=e.location)==null?void 0:E.coords)&&t(B,{className:"orange",onClick:r=>{r.stopPropagation(),d(e)}}),((p=a.Companies)==null?void 0:p.Enabled)!==!1&&e.canCall!==!1&&t(Y,{className:"green",onClick:r=>{r.stopPropagation(),S(e.job,e.name)}}),e.canMessage!==!1&&t(Z,{className:"green",onClick:r=>{r.stopPropagation(),P(e)}})]}):i(T,{children:[i("div",{className:"actions",onMouseEnter:()=>l(!1),onMouseLeave:()=>l(!0),children:[((A=e.location)==null?void 0:A.coords)&&t(B,{className:"orange",onClick:r=>{r.stopPropagation(),d(e)}}),e.canMessage!==!1&&a.Companies.MessageOffline&&t(Z,{className:"green",onClick:r=>{r.stopPropagation(),P(e)}})]}),t(ne,{children:u&&t(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},className:"closed",children:n("APPS.SERVICES.CLOSED")})})]})]},e.name)};function De(){const e=f(V.PhoneNumber),[a,o]=C.useState({personal:[],job:[]}),[u,l]=C.useState("personal");return C.useEffect(()=>{x("Services")&&v("Services",{action:"getRecentMessages",page:0},w.messageList).then(d=>{if(!d)return g("warning","No recent messages found");o({personal:[...d.filter(S=>S.number===e)],job:[...d.filter(S=>S.number!==e)]})})},[]),q("services:channelDeleted",d=>{if(!d)return g("error","No channel ID provided");o({personal:a.personal.filter(S=>S.id!==d),job:a.job.filter(S=>S.id!==d)})}),t(T,{children:i("div",{className:"company-messages-container",children:[t("div",{className:"company-messages-header",children:t("div",{className:"selector",children:["personal","job"].map((d,S)=>t("div",{className:"option","data-active":u===d,onClick:()=>l(d),children:n(`APPS.SERVICES.${d.toUpperCase()}`)},S))})}),t(O.section,{...ie(u==="personal"?"right":"left",u,.2),children:(a==null?void 0:a[u])&&(a==null?void 0:a[u].map((d,S)=>t(Me,{channel:d,type:u},S)))})]})})}const Me=({channel:e,type:a})=>{var d,S;const o=f(V.Settings),u=ge(()=>{var P;(P=F)!=null&&P.value.Companies.DeleteConversations&&a!=="personal"&&b.ContextMenu.set({buttons:[{title:n("APPS.MESSAGES.DELETE_CONVERSATION.TITLE"),color:"red",cb:()=>{setTimeout(()=>{b.PopUp.set({title:n("APPS.MESSAGES.DELETE_CONVERSATION.TITLE"),description:n("APPS.MESSAGES.DELETE_CONVERSATION.DESCRIPTION"),buttons:[{title:n("APPS.MESSAGES.DELETE_CONVERSATION.CANCEL")},{title:n("APPS.MESSAGES.DELETE_CONVERSATION.DELETE"),color:"red",cb:()=>{v("Services",{action:"deleteChannel",id:e.id},!0).then(s=>{if(!s)return g("error","Failed to delete channel, deleteChannel returned false")})}}]})},100)}}]})}),l=P=>{if(P)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(P)};return i("div",{...u,className:"item",onClick:()=>{var P,s,E;L.set({...L==null?void 0:L.value,id:e.id,icon:a==="personal"&&((P=e==null?void 0:e.company)!=null&&P.icon)?e.company.icon:`./assets/img/avatar-placeholder-${o.display.theme}.svg`,company:a==="personal"&&((s=e==null?void 0:e.company)!=null&&s.name)?e.company.name:D(e.number),job:(E=e.company)==null?void 0:E.job,number:e.number}),M.set("chat")},children:[a==="personal"&&((d=e==null?void 0:e.company)!=null&&d.icon)?t("img",{src:e.company.icon}):t("img",{src:`./assets/img/avatar-placeholder-${o.display.theme}.svg`}),i("div",{className:"info",children:[i("div",{className:"info-header",children:[t("div",{className:"user",children:a==="personal"&&((S=e==null?void 0:e.company)!=null&&S.name)?e.company.name:D(e.number)}),i("div",{className:"right",children:[t("div",{className:"time",children:$(e.timestamp)}),t(fe,{})]})]}),t("div",{className:"message",children:l(e.lastMessage)?n("APPS.MESSAGES.SENT_LOCATION_SHORT"):e.lastMessage})]})]})};function Ve(){const e=f(F),a=f(M),[o,u]=C.useState([{icon:t(ae,{}),title:n("APPS.SERVICES.COMPANIES"),value:"companies"},{icon:t(te,{}),title:n("APPS.SERVICES.MESSAGES"),value:"messages"}]);return C.useEffect(()=>{var l,d;((d=(l=e==null?void 0:e.Companies)==null?void 0:l.Management)==null?void 0:d.Enabled)!==!1&&u([...o,{icon:t(be,{}),title:n("APPS.SERVICES.ACTIONS"),value:"actions"}])},[]),t("div",{className:"companies-footer",children:o.map((l,d)=>i("div",{className:"item","data-active":a===l.value,onClick:()=>M.set(l.value),children:[l.icon,l.title]},d))})}const M=X("companies"),L=X(null);function Ue(){const e=f(M),a=f(j),o={companies:t(Te,{}),actions:t(Ae,{}),messages:t(De,{}),chat:t(Oe,{})};let u={actions:n("APPS.SERVICES.ACTIONS"),messages:n("APPS.SERVICES.MESSAGES"),companies:n("APPS.SERVICES.COMPANIES")};return i("div",{className:"companies-container","data-view":e,children:[t(ne,{children:a&&t(Le,{})}),i(O.div,{...ie(e==="chat"?"left":"right",e,.2),className:"companies-wrapper",children:[e!=="chat"&&t("div",{className:"companies-header",children:t("div",{className:"title",children:u[e]})}),t("div",{className:"companies-body",children:o[e]})]}),e!=="chat"&&t(Ve,{})]})}export{L as Data,M as View,Ue as default};
