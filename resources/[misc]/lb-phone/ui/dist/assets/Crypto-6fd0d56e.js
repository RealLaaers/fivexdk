import{r as p,j as S,a as r,N as U,m as f,u as L,E as w,bX as I,b as g,q as N,p as Y,_ as x,a9 as _,t as v,L as t,c8 as B,c9 as k,w as F,ca as $,cb as D,C as R,f as j,P as H,A as M}from"./index-ab956fb7.js";function z({children:e,text:i}){const[C,m]=p.useState(!1);return S("div",{className:"tooltip-wrapper",onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:[e,r(U,{children:C&&r(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"tooltip top",children:r("div",{dangerouslySetInnerHTML:{__html:i}})})})]})}const b=p.createContext(null);function W(){var c;const e=L(g),i=L(H.Settings),C=L(M),[m,h]=p.useState(0),[E,O]=p.useState([]),[o,P]=p.useState(""),[A,d]=p.useState("0"),[n,l]=p.useState(i==null?void 0:i.streamerMode);p.useEffect(()=>{w("Crypto")&&(I()&&fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&sparkline=true&order=market_cap_desc&per_page=100&page=1&ids=${g.value.Crypto.Coins.join(",")}`).then(s=>s.json()).then(s=>{O(s.map(a=>{var T;return{id:a.id,name:a.name,symbol:a.symbol,image:a.image,current_price:a.current_price,prices:(T=a.sparkline_in_7d)==null?void 0:T.price,change_24h:a.price_change_percentage_24h}}))}).catch(s=>N("error",s)),Y("Crypto",{action:"get"}).then(s=>{if(!s)return N("warning","No data received from Crypto NUI event");O(s)}))},[C==null?void 0:C.active]),x("crypto:updateCoins",s=>{if(!s)return N("warning","No data received from the update Crypto NUI event");O(s)}),p.useEffect(()=>h(E.reduce((s,a)=>s+(a.owned??0)*a.current_price,0)),[E]),p.useEffect(()=>{d(n?_("âˆ—".repeat(v(m,2).toString().length)):_(v(m,2)))},[m,n]);const u=s=>{let a={0:50,10:45,12:40,14:35},T=0;for(let y=0;y<Object.keys(a).length;y++)s.length>=parseInt(Object.keys(a)[y])&&(T=a[Object.keys(a)[y]]);return T};return S("div",{className:"crypto-container",children:[S("div",{className:"crypto-header",children:[r("img",{src:"./assets/img/icons/apps/Cryptopng.png",alt:"btc"}),t("APPS.CRYPTO.TITLE")]}),r(b.Provider,{value:{Coins:[E,O]},children:S("div",{className:"crypto-wrapper",children:[S("div",{className:"balance",children:[S("div",{className:"title",children:[t("APPS.CRYPTO.BALANCE"),r("div",{className:"icon",onClick:()=>l(!n),children:n?r(B,{}):r(k,{})})]}),r("div",{className:"amount",style:{fontSize:u(A.toString())},onClick:()=>l(!n),children:(c=e==null?void 0:e.CurrencyFormat)==null?void 0:c.replace("%s",A.toString())})]}),r("div",{className:"search",children:r(F,{placeholder:"Search Cryptocurrency",onChange:s=>P(s.target.value)})}),r(G,{search:o}),r("div",{className:"credits",children:"Powered by CoinGecko"})]})})]})}const G=({search:e})=>{const[i,C]=p.useState("balance"),[m,h]=p.useState(!0),E=["Name","Graph","Balance"],[O]=p.useContext(b).Coins;return r("div",{className:"holdings",children:S("div",{className:"items",children:[r("div",{className:"item filters",children:E.map((o,P)=>S("div",{className:"filter",onClick:()=>{if(C(o.toLowerCase()),i===o.toLowerCase())return h(!m);h(!0)},children:[o,o.toLowerCase()===i&&m?r($,{}):r(D,{})]},P))}),O.sort((o,P)=>i==="name"?m?o.name.localeCompare(P.name):P.name.localeCompare(o.name):i==="graph"?m?o.change_24h-P.change_24h:P.change_24h-o.change_24h:i==="balance"?m?(P.owned??0)*P.current_price-(o.owned??0)*o.current_price:(o.owned??0)*o.current_price-(P.owned??0)*P.current_price:0).filter(o=>o.name.toLowerCase().includes(e.toLowerCase())||o.symbol.toLowerCase().includes(e.toLowerCase())).map((o,P)=>r(q,{data:o},P))]})})},q=({data:e})=>{const[i,C]=p.useState(!1),[m,h]=p.useState(""),[E,O]=p.useContext(b).Coins,o=(d,n)=>{n>1?Y("Crypto",{action:"buy",coin:d,amount:n}).then(l=>{if(l!=null&&l.success)return O(u=>u.map(c=>c.id===d?{...c,owned:(c.owned??0)+n/c.current_price,value:(c.value??0)+n,invested:(c.invested??0)+n}:c));l!=null&&l.msg&&setTimeout(()=>{R.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${l.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{R.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.BUY").toLowerCase(),currency:g.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)},P=(d,n,l)=>{l>0?Y("Crypto",{action:"sell",coin:d,amount:l}).then(u=>{if(u!=null&&u.success)return O(c=>c.map(s=>s.id===d?{...s,owned:(s.owned??0)-n/s.current_price,value:(s.value??0)+n,invested:(s.invested??0)-n}:s));u!=null&&u.msg&&setTimeout(()=>{R.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${u.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{R.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.SELL").toLowerCase(),currency:g.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)},A=(d,n,l,u)=>{l>0?Y("Crypto",{action:"transfer",coin:d,amount:l,number:u}).then(c=>{c!=null&&c.success&&setTimeout(()=>{R.PopUp.set({title:t("APPS.CRYPTO.SUCCESSFULLY_TRANSFERED_POPUP.TITLE"),description:t("APPS.CRYPTO.SUCCESSFULLY_TRANSFERED_POPUP.DESCRIPTION").format({amount:n,coin:e.symbol,number:j(u)}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]}),O(s=>s.map(a=>a.id===d?{...a,owned:(a.owned??0)-n/a.current_price,value:(a.value??0)+n,invested:(a.invested??0)-n}:a))},250),c!=null&&c.msg&&setTimeout(()=>{R.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${c.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{R.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.TRANSFER").toLowerCase(),currency:g.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)};return e.symbol=e.symbol.toUpperCase(),e.owned=e.owned??0,e.value=e.current_price*(e.owned??0),S("div",{className:"item",onClick:()=>C(!i),children:[S("div",{className:"top",children:[S("div",{className:"info",children:[r("img",{src:e.image,className:"icon",alt:"Icon"}),S("div",{className:"coin",children:[r("div",{className:"name",children:e.symbol}),r("div",{className:"symbol",children:e.name})]})]}),r(X,{data:e}),S("div",{className:"amount",children:[r("div",{className:"value",children:_(v(e.owned,4))}),S("div",{className:"asset",children:["$",_(v(e.value,2))]})]})]}),r(U,{children:i&&S(f.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"bottom",children:[r(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button fill",onClick:d=>{d.stopPropagation(),R.PopUp.set({title:t("APPS.CRYPTO.BUY_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.BUY_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:n=>h(n)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{h(n=>(o(e.id,parseFloat(n)),n))}}]})},children:t("APPS.CRYPTO.BUY")}),r(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button",onClick:d=>{d.stopPropagation(),R.PopUp.set({title:t("APPS.CRYPTO.SELL_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.SELL_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:n=>h(n)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{h(n=>{let l=parseFloat(n),u=l/e.current_price;return P(e.id,l,u),n})}}]})},children:t("APPS.CRYPTO.SELL")}),r(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button blue",onClick:d=>{d.stopPropagation(),R.PopUp.set({title:t("APPS.CRYPTO.TRANSFER_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.TRANSFER_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:n=>h(n)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.TRANSFER_POPUP.NEXT"),cb:()=>{h(n=>{let l=parseFloat(n),u=l/e.current_price;return R.ContactSelector.set({onSelect:c=>{if(!c)return N("warning","No contact selected? Cancelling request");A(e.id,l,u,c.number)}}),n})}}]})},children:t("APPS.CRYPTO.TRANSFER")}),r(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button red",onClick:d=>{d.stopPropagation(),R.PopUp.set({title:t("APPS.CRYPTO.SELL_ALL_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.SELL_ALL_POPUP.DESCRIPTION").format({coin:e.symbol,amount:e.owned*e.current_price}),buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),color:"red",cb:()=>{let n=e.owned*e.current_price;P(e.id,n,e.owned)}}]})},children:t("APPS.CRYPTO.SELL_ALL")})]})})]})},X=e=>{if(!(e!=null&&e.data.prices))return null;let i=e.data.prices;const C=p.useRef(null),[m,h]=p.useState(null),[E,O]=p.useState(null);return i=i.slice(0,24),p.useEffect(()=>{if(!(C!=null&&C.current))return;const o=C.current;o.width=150,o.height=100;const P=o.getContext("2d");P.lineWidth=3;const A=Math.min(...i),n=Math.max(...i)-A,l=o.height-10;let u=0,c=o.height-5-(i[0]-A)/n*l;P.beginPath(),P.moveTo(u,c);const s=i[i.length-1]-i[0]>0?"green":"red";P.strokeStyle=s;for(let y=1;y<i.length;y++)u+=o.width/(i.length-1),c=o.height-5-(i[y]-A)/n*l,P.lineTo(u,c);P.stroke();const a=(i[i.length-1]-i[0])/i[0]*100;a>0?h(`<div style="color: var(--phone-color-green)">+${v(a,2)}%</div>`):a<0?h(`<div style="color: var(--phone-color-red)">${v(a,2)}%</div>`):h(`<div>${v(a,2)}%</div>`);let T=(e.data.value-e.data.invested)/e.data.invested*100;T>0?O(`<div style="color: var(--phone-color-green)">+${v(T,2)}%</div>`):T<0&&O(`<div style="color: var(--phone-color-red)">${v(T,2)}%</div>`)},[C,i]),r(z,{text:`$${v(e.data.current_price,2)} ${m??""} ${E??""}`,children:r("canvas",{ref:C})})};export{W as default};
